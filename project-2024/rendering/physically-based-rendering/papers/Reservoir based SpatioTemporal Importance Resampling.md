
본 노트는 ReSTIR 원문을 이해하기 위해 요약한 노트입니다.

---

수백 만 개의 동적인 광원을 몬테 카를로 적분법을 사용하여 효과적으로 렌더링하는 것은 매우 어려운 문제로 남아있습니다.
심지어 실시간성이 중요하지 않은 offline 렌더링 시스템에서조차 쉽지 않은 일이죠.

이 문제를 해결하기 위해 ReSTIR이라는 새로운 알고리즘을 개발하였습니다.
ReSTIR 알고리즘은 그러한 수백 만개의 동적인 광원을 높은 품질과 상호작용성을 유지하며 렌더링할 수 있게 도와줍니다.
또한, 기존 방식에서 요구되었던 복잡한 자료구조를 필요로 하지 않습니다.

ReSTIR에서는 광원 샘플들의 집합으로부터 다시 샘플링을 진행합니다.
이때 해당 샘플과 관련있는 주위의 샘플들에 대한 정보를 반영하기 위해서 공간과 시간에 대한 샘플링을 합니다.

이 알고리즘을 통해 Unbiased 몬테 카를로 추정량을 유도할 수 있고, 동일한 에러 수준을 유지하며 최신 방법들보다 약 60배 빠른 성능을 보여줍니다.
Biased 추정량은 Unbiased보다 노이즈를 더 감소시킬 수 있고, 약 35~60배 더 빠른 성능을 보여줍니다. (단 biased하기 때문에 에너지 보존을 지킬 수 없고, 렌더링 과정에서 일정량에 에너지가 소실됩니다.)

![](../../../../images/Pasted%20image%2020240603221243.png)
- ReSTIR 알고리즘은 기본적으로 샘플링 퀄리티를 향상시키는데 초점을 맞추고 있습니다. 렌더링된 결과 이미지를 NVIDIA의 OptiX와 같은 denoiser(노이즈 제거기)를 사용하면 이미지 퀄리티를 더 향상시킬 수 있습니다.

# 1. Introduction

최근 몇년 동안, 몬테 카를로 적분법 기반의 path tracing은 많은 offline 렌더링에서 사용되었습니다. 
특수 목적의 GPU 하드웨어가 (예를 들면, Nvidia RTX) ray intersection 테스트를 지원하기 시작한 이후, 실시간 렌더링 어플리케이션에서도 그 사용 사례가 점차 늘어나고 있습니다.  
하지만 실시간에 대한 제약이 없는 offline rendering에서도 많은 광원으로부터의 d직접을 다루는 것은 어려운 문제입니다. 
 
문제를 푸는 것을 어렵게 만드는 데는 여러 요인이 있습니다.
  - 모든 광원에 대한 shadow ray들을 추적하는 것
  - 어떠한 한 점에 대한 각각의 빛의 가시성을 고려하며 그 점에 가장 많은 기여를 하는 빛들을 알아내는 것
  - 한 점에 대한 scattering function에 대한 분포를 알아내는 것
  - 광원의 세기와 발광 특성을 고려하는 것

이 상황에서 실시간성까지 적용하고 하면, 문제가 더 복잡해지게 됩니다. 
실시간 어플리케이션에서는 렌더링 하고자 하는 scene이 동적입니다. scene의 상태는 어플리케이션을 사용하는 유저에 의해 바뀔 수 있기 때문에, 렌더러는 다음 scene이 어떻게 변할지 예측할 수 없습니다.
게다가, 현재는 각 픽셀에서 추적할 수 있는 ray의 수가 많지 않기에 중요한 광원들을 찾아내는 것이 훨씬 더 중요하게 됩니다. (그렇지 못하다면, 렌더링 결과에 많은 노이즈가 존재하겠죠.)
하지만, 실시간성을 만족시키기 위해선 광원 샘플링을 도와주는 자료구조를 만들고 업데이트하는데 시간적 제약이 존재합니다.
위에 나열된 내용들은 이 논문에서 다루는 first camera 정점에 대한 직접광을 계산하는 제한된 경우에도 적용됩니다.

이러한 제약들을 극복하기 위해, denoising분야 와 하나의 픽셀 당 적은 샘플로만 렌더링된 noisy 이미지로부터 reconstructing하는 분야에서 많은 연구가 이루어져 왔습니다. 
실시간과 오프라인 렌더링 분야에서 큰 진전이 있어온 와중에, 실시간 denoiser에서는 필터링에 사용되는 시간이 frame time의 일부분을 잡아먹기 때문에 제한된 처리 시간만이 허용됐습니다. 
노이즈 제거 문제는 특히 샘플 수가 적은 이미지에서 더 어려워집니다. 때문에 샘플들의 퀄리티를 향상시켜서 denoiser에게 전달한다면 상당한 효과를 얻을 수 있습니다. (ReSTIR은 샘플의 퀄리티를 향상하는 알고리즘이니 궁합이 좋네요.)

이 논문에서는 많은 광원으로부터 한번의 반사가 일어나는 direct lighting 에 대해 샘플을 하는 방법을 소개합니다. 이 방법은 완전히 동적인 scene을 가지고 있는 실시간 ray tracing 에도 적용됩니다.

ReSTIR은 Resampled Importance sampling(줄여서 RIS)위에서 만들어졌습니다. 
RIS는 하나의 확률 분포에서 샘플들의 집합을 취하고, 우리가 적분하고 싶은 함수와 더 잘 들어맞는 또 다른 분포를 이용해서 이전에 뽑았던 샘플들에 대한 가중치가 적용된 부분집합을 선택하는 방법입니다.

그러나 ReSTIR의 차이점은 이전에 RIS가 응용되었던 방법과 달리 reservoir라는 고정된 크기의 자료구조를 이용하여 오직 받아들일 수 있는 샘플들만 reservoir에 저장하여 안정적이면서도 실시간의 성능을 낼 수 있다는 것입니다.

Reservoir를 이용하여, 더 이상 고정 크기의 배열보다 복잡한 자료구조를 필요로하지 않습니다. 그러면서도 시간적인 이웃과 공간적인 이웃으로부터의 정보를 활용함으로써, 각각의 픽셀의 직접광 샘플링 확률 밀도 함수를 통계적으로, 점진적으로 그리고 위계적으로 향상시킵니다.